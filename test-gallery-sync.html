<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Galer√≠a Sync - Casa Nuvera</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 2rem;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 2rem;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            margin: 0.5rem;
        }
        button:hover {
            background: #2980b9;
        }
        .success {
            background: #27ae60;
        }
        .success:hover {
            background: #229954;
        }
        .error {
            background: #e74c3c;
        }
        .error:hover {
            background: #c0392b;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 1rem;
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .status {
            padding: 0.5rem;
            border-radius: 4px;
            margin: 0.5rem 0;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test de Sincronizaci√≥n de Galer√≠a</h1>
        <p>Esta p√°gina te permite probar la sincronizaci√≥n entre el admin de galer√≠a y el sitio web principal.</p>

        <div class="test-section">
            <h3>üìä Estado Actual</h3>
            <div id="currentStatus">
                <div class="status info">Verificando datos de galer√≠a...</div>
            </div>
            <button onclick="checkGalleryData()">üîÑ Verificar Datos</button>
        </div>

        <div class="test-section">
            <h3>üé¨ Datos de Prueba</h3>
            <p>Usa estos botones para simular datos de galer√≠a:</p>
            <button onclick="setTestData()">üìù Establecer Datos de Prueba</button>
            <button onclick="setVideoData()">üé• Establecer Datos con Videos</button>
            <button onclick="clearData()">üóëÔ∏è Limpiar Datos</button>
        </div>

        <div class="test-section">
            <h3>üöÄ Sincronizaci√≥n</h3>
            <p>Prueba la sincronizaci√≥n con el sitio web:</p>
            <button onclick="simulateSync()" class="success">üîÑ Simular Sincronizaci√≥n</button>
            <button onclick="openIndex()">üåê Abrir Index</button>
        </div>

        <div class="test-section">
            <h3>üìã Log de Actividad</h3>
            <div id="log" class="log">Esperando actividad...</div>
            <button onclick="clearLog()">üßπ Limpiar Log</button>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            logDiv.textContent += logEntry;
            logDiv.scrollTop = logDiv.scrollHeight;
            
            console.log(`[TEST] ${message}`);
        }

        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('currentStatus');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function checkGalleryData() {
            log('üîç Verificando datos de galer√≠a...');
            
            const savedGalleryData = localStorage.getItem('casaNuveraGalleryData');
            const savedActiveData = localStorage.getItem('casaNuveraActiveGalleryData');
            
            if (savedActiveData) {
                try {
                    const data = JSON.parse(savedActiveData);
                    updateStatus(`‚úÖ Datos activos encontrados: ${data.length} slides`, 'success');
                    log(`üìã Slides activos: ${data.length}`);
                    data.forEach((slide, index) => {
                        log(`  ${index + 1}. ${slide.title} (${slide.type}) - ${slide.active ? 'Activo' : 'Inactivo'}`);
                    });
                } catch (e) {
                    updateStatus('‚ùå Error parseando datos activos', 'error');
                    log(`‚ùå Error: ${e.message}`);
                }
            } else if (savedGalleryData) {
                try {
                    const data = JSON.parse(savedGalleryData);
                    const activeSlides = data.filter(slide => slide.active);
                    updateStatus(`‚ÑπÔ∏è Datos totales: ${data.length} slides, ${activeSlides.length} activos`, 'info');
                    log(`üìã Total slides: ${data.length}, Activos: ${activeSlides.length}`);
                } catch (e) {
                    updateStatus('‚ùå Error parseando datos de galer√≠a', 'error');
                    log(`‚ùå Error: ${e.message}`);
                }
            } else {
                updateStatus('‚ö†Ô∏è No hay datos de galer√≠a guardados', 'error');
                log('‚ö†Ô∏è No se encontraron datos de galer√≠a');
            }
        }

        function setTestData() {
            const testData = [
                {
                    id: 1,
                    title: "Espacios que Inspiran",
                    description: "Cada propiedad cuenta una historia √∫nica",
                    type: "image",
                    url: "https://otfbouzmhmmguvqbbwku.supabase.co/storage/v1/object/public/imagenes-sitio/imagen_1756150801258_0.jpeg",
                    order: 1,
                    active: true,
                    propertyId: 1,
                    slug: "departamento-los-llanes"
                },
                {
                    id: 2,
                    title: "Calidad en Cada Detalle",
                    description: "Propiedades seleccionadas con los m√°s altos est√°ndares",
                    type: "image",
                    url: "https://otfbouzmhmmguvqbbwku.supabase.co/storage/v1/object/public/imagenes-sitio/imagen_1756150948654_0.jpeg",
                    order: 2,
                    active: true,
                    propertyId: 2,
                    slug: "casa-moderna-providencia"
                }
            ];

            localStorage.setItem('casaNuveraGalleryData', JSON.stringify(testData));
            localStorage.setItem('casaNuveraActiveGalleryData', JSON.stringify(testData));
            
            updateStatus('‚úÖ Datos de prueba establecidos (2 slides)', 'success');
            log('üìù Datos de prueba establecidos con 2 slides de imagen');
        }

        function setVideoData() {
            const videoData = [
                {
                    id: 1,
                    title: "Tour Virtual Inmersivo",
                    description: "Recorre propiedades desde la comodidad de tu hogar",
                    type: "video",
                    url: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4",
                    order: 1,
                    active: true,
                    propertyId: 1,
                    slug: "video-tour-1"
                },
                {
                    id: 2,
                    title: "Tecnolog√≠a de Vanguardia",
                    description: "Innovaci√≥n aplicada al sector inmobiliario",
                    type: "video",
                    url: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4",
                    order: 2,
                    active: true,
                    propertyId: 2,
                    slug: "video-tour-2"
                },
                {
                    id: 3,
                    title: "Espacios que Inspiran",
                    description: "Cada propiedad cuenta una historia √∫nica",
                    type: "image",
                    url: "https://otfbouzmhmmguvqbbwku.supabase.co/storage/v1/object/public/imagenes-sitio/imagen_1756150801258_0.jpeg",
                    order: 3,
                    active: true,
                    propertyId: 3,
                    slug: "departamento-los-llanes"
                }
            ];

            localStorage.setItem('casaNuveraGalleryData', JSON.stringify(videoData));
            localStorage.setItem('casaNuveraActiveGalleryData', JSON.stringify(videoData));
            
            updateStatus('‚úÖ Datos con videos establecidos (3 slides)', 'success');
            log('üé• Datos con videos establecidos: 2 videos + 1 imagen');
        }

        function clearData() {
            localStorage.removeItem('casaNuveraGalleryData');
            localStorage.removeItem('casaNuveraActiveGalleryData');
            
            updateStatus('üóëÔ∏è Datos de galer√≠a eliminados', 'info');
            log('üóëÔ∏è Datos de galer√≠a eliminados del localStorage');
        }

        function simulateSync() {
            log('üîÑ Simulando proceso de sincronizaci√≥n...');
            
            const savedActiveData = localStorage.getItem('casaNuveraActiveGalleryData');
            if (!savedActiveData) {
                updateStatus('‚ùå No hay datos para sincronizar', 'error');
                log('‚ùå No se encontraron datos activos para sincronizar');
                return;
            }

            try {
                const data = JSON.parse(savedActiveData);
                log(`‚úÖ Sincronizaci√≥n simulada exitosa con ${data.length} slides`);
                
                // Simular el proceso que har√≠a el admin
                log('üì§ Guardando datos en localStorage...');
                log('üì§ Guardando datos en sessionStorage...');
                log('üì§ Datos guardados correctamente');
                
                updateStatus(`‚úÖ Sincronizaci√≥n simulada: ${data.length} slides listos`, 'success');
                
                // Mostrar detalles de los slides
                data.forEach((slide, index) => {
                    log(`  ${index + 1}. ${slide.title} (${slide.type}) - Orden: ${slide.order}`);
                });
                
            } catch (e) {
                updateStatus('‚ùå Error en sincronizaci√≥n simulada', 'error');
                log(`‚ùå Error: ${e.message}`);
            }
        }

        function openIndex() {
            log('üåê Abriendo index.html en nueva pesta√±a...');
            const indexWindow = window.open('index.html', '_blank');
            
            if (indexWindow) {
                log('‚úÖ Index.html abierto correctamente');
                updateStatus('üåê Index.html abierto - Verifica la galer√≠a', 'info');
                
                // Intentar recargar la galer√≠a despu√©s de un momento
                setTimeout(() => {
                    try {
                        if (indexWindow.reloadGalleryFromAdmin) {
                            indexWindow.reloadGalleryFromAdmin();
                            log('üîÑ Funci√≥n reloadGalleryFromAdmin ejecutada');
                        } else {
                            log('‚ö†Ô∏è Funci√≥n reloadGalleryFromAdmin no disponible');
                        }
                    } catch (e) {
                        log(`‚ö†Ô∏è Error ejecutando reloadGalleryFromAdmin: ${e.message}`);
                    }
                }, 2000);
            } else {
                log('‚ùå No se pudo abrir index.html (posible bloqueador de pop-ups)');
                updateStatus('‚ùå Error abriendo index.html', 'error');
            }
        }

        function clearLog() {
            document.getElementById('log').textContent = 'Log limpiado...\n';
        }

        // Verificar datos al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', () => {
            log('üß™ P√°gina de test cargada');
            checkGalleryData();
        });
    </script>
</body>
</html>