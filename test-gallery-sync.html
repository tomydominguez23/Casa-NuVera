<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test GalerÃ­a Sync - Casa Nuvera</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 2rem;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 2rem;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            margin: 0.5rem;
        }
        button:hover {
            background: #2980b9;
        }
        .success {
            background: #27ae60;
        }
        .success:hover {
            background: #229954;
        }
        .error {
            background: #e74c3c;
        }
        .error:hover {
            background: #c0392b;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 1rem;
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .status {
            padding: 0.5rem;
            border-radius: 4px;
            margin: 0.5rem 0;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Test de SincronizaciÃ³n de GalerÃ­a</h1>
        <p>Esta pÃ¡gina te permite probar la sincronizaciÃ³n entre el admin de galerÃ­a y el sitio web principal.</p>

        <div class="test-section">
            <h3>ğŸ“Š Estado Actual</h3>
            <div id="currentStatus">
                <div class="status info">Verificando datos de galerÃ­a...</div>
            </div>
            <button onclick="checkGalleryData()">ğŸ”„ Verificar Datos</button>
        </div>

        <div class="test-section">
            <h3>ğŸ¬ Datos de Prueba</h3>
            <p>Usa estos botones para simular datos de galerÃ­a:</p>
            <button onclick="setTestData()">ğŸ“ Establecer Datos de Prueba</button>
            <button onclick="setVideoData()">ğŸ¥ Establecer Datos con Videos</button>
            <button onclick="clearData()">ğŸ—‘ï¸ Limpiar Datos</button>
        </div>

        <div class="test-section">
            <h3>ğŸš€ SincronizaciÃ³n</h3>
            <p>Prueba la sincronizaciÃ³n con el sitio web:</p>
            <button onclick="simulateSync()" class="success">ğŸ”„ Simular SincronizaciÃ³n</button>
            <button onclick="openIndex()">ğŸŒ Abrir Index</button>
        </div>

        <div class="test-section">
            <h3>ğŸ“‹ Log de Actividad</h3>
            <div id="log" class="log">Esperando actividad...</div>
            <button onclick="clearLog()">ğŸ§¹ Limpiar Log</button>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            logDiv.textContent += logEntry;
            logDiv.scrollTop = logDiv.scrollHeight;
            
            console.log(`[TEST] ${message}`);
        }

        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('currentStatus');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function checkGalleryData() {
            log('ğŸ” Verificando datos de galerÃ­a...');
            
            const savedGalleryData = localStorage.getItem('casaNuveraGalleryData');
            const savedActiveData = localStorage.getItem('casaNuveraActiveGalleryData');
            
            if (savedActiveData) {
                try {
                    const data = JSON.parse(savedActiveData);
                    updateStatus(`âœ… Datos activos encontrados: ${data.length} slides`, 'success');
                    log(`ğŸ“‹ Slides activos: ${data.length}`);
                    data.forEach((slide, index) => {
                        log(`  ${index + 1}. ${slide.title} (${slide.type}) - ${slide.active ? 'Activo' : 'Inactivo'}`);
                    });
                } catch (e) {
                    updateStatus('âŒ Error parseando datos activos', 'error');
                    log(`âŒ Error: ${e.message}`);
                }
            } else if (savedGalleryData) {
                try {
                    const data = JSON.parse(savedGalleryData);
                    const activeSlides = data.filter(slide => slide.active);
                    updateStatus(`â„¹ï¸ Datos totales: ${data.length} slides, ${activeSlides.length} activos`, 'info');
                    log(`ğŸ“‹ Total slides: ${data.length}, Activos: ${activeSlides.length}`);
                } catch (e) {
                    updateStatus('âŒ Error parseando datos de galerÃ­a', 'error');
                    log(`âŒ Error: ${e.message}`);
                }
            } else {
                updateStatus('âš ï¸ No hay datos de galerÃ­a guardados', 'error');
                log('âš ï¸ No se encontraron datos de galerÃ­a');
            }
        }

        function setTestData() {
            const testData = [
                {
                    id: 1,
                    title: "Espacios que Inspiran",
                    description: "Cada propiedad cuenta una historia Ãºnica",
                    type: "image",
                    url: "https://otfbouzmhmmguvqbbwku.supabase.co/storage/v1/object/public/imagenes-sitio/imagen_1756150801258_0.jpeg",
                    order: 1,
                    active: true,
                    propertyId: 1,
                    slug: "departamento-los-llanes"
                },
                {
                    id: 2,
                    title: "Calidad en Cada Detalle",
                    description: "Propiedades seleccionadas con los mÃ¡s altos estÃ¡ndares",
                    type: "image",
                    url: "https://otfbouzmhmmguvqbbwku.supabase.co/storage/v1/object/public/imagenes-sitio/imagen_1756150948654_0.jpeg",
                    order: 2,
                    active: true,
                    propertyId: 2,
                    slug: "casa-moderna-providencia"
                }
            ];

            localStorage.setItem('casaNuveraGalleryData', JSON.stringify(testData));
            localStorage.setItem('casaNuveraActiveGalleryData', JSON.stringify(testData));
            
            updateStatus('âœ… Datos de prueba establecidos (2 slides)', 'success');
            log('ğŸ“ Datos de prueba establecidos con 2 slides de imagen');
        }

        function setVideoData() {
            const videoData = [
                {
                    id: 1,
                    title: "Tour Virtual Inmersivo",
                    description: "Recorre propiedades desde la comodidad de tu hogar",
                    type: "video",
                    url: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4",
                    order: 1,
                    active: true,
                    propertyId: 1,
                    slug: "video-tour-1"
                },
                {
                    id: 2,
                    title: "TecnologÃ­a de Vanguardia",
                    description: "InnovaciÃ³n aplicada al sector inmobiliario",
                    type: "video",
                    url: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4",
                    order: 2,
                    active: true,
                    propertyId: 2,
                    slug: "video-tour-2"
                },
                {
                    id: 3,
                    title: "Espacios que Inspiran",
                    description: "Cada propiedad cuenta una historia Ãºnica",
                    type: "image",
                    url: "https://otfbouzmhmmguvqbbwku.supabase.co/storage/v1/object/public/imagenes-sitio/imagen_1756150801258_0.jpeg",
                    order: 3,
                    active: true,
                    propertyId: 3,
                    slug: "departamento-los-llanes"
                }
            ];

            localStorage.setItem('casaNuveraGalleryData', JSON.stringify(videoData));
            localStorage.setItem('casaNuveraActiveGalleryData', JSON.stringify(videoData));
            
            updateStatus('âœ… Datos con videos establecidos (3 slides)', 'success');
            log('ğŸ¥ Datos con videos establecidos: 2 videos + 1 imagen');
        }

        function clearData() {
            localStorage.removeItem('casaNuveraGalleryData');
            localStorage.removeItem('casaNuveraActiveGalleryData');
            
            updateStatus('ğŸ—‘ï¸ Datos de galerÃ­a eliminados', 'info');
            log('ğŸ—‘ï¸ Datos de galerÃ­a eliminados del localStorage');
        }

        function simulateSync() {
            log('ğŸ”„ Simulando proceso de sincronizaciÃ³n...');
            
            const savedActiveData = localStorage.getItem('casaNuveraActiveGalleryData');
            if (!savedActiveData) {
                updateStatus('âŒ No hay datos para sincronizar', 'error');
                log('âŒ No se encontraron datos activos para sincronizar');
                return;
            }

            try {
                const data = JSON.parse(savedActiveData);
                log(`âœ… SincronizaciÃ³n simulada exitosa con ${data.length} slides`);
                
                // Simular el proceso que harÃ­a el admin
                log('ğŸ“¤ Guardando datos en localStorage...');
                log('ğŸ“¤ Guardando datos en sessionStorage...');
                log('ğŸ“¤ Datos guardados correctamente');
                
                updateStatus(`âœ… SincronizaciÃ³n simulada: ${data.length} slides listos`, 'success');
                
                // Mostrar detalles de los slides
                data.forEach((slide, index) => {
                    log(`  ${index + 1}. ${slide.title} (${slide.type}) - Orden: ${slide.order}`);
                });
                
            } catch (e) {
                updateStatus('âŒ Error en sincronizaciÃ³n simulada', 'error');
                log(`âŒ Error: ${e.message}`);
            }
        }

        function openIndex() {
            log('ğŸŒ Abriendo index.html en nueva pestaÃ±a...');
            const indexWindow = window.open('index.html', '_blank');
            
            if (indexWindow) {
                log('âœ… Index.html abierto correctamente');
                updateStatus('ğŸŒ Index.html abierto - Verifica la galerÃ­a', 'info');
                
                // Intentar recargar la galerÃ­a despuÃ©s de un momento
                setTimeout(() => {
                    try {
                        if (indexWindow.reloadGalleryFromAdmin) {
                            indexWindow.reloadGalleryFromAdmin();
                            log('ğŸ”„ FunciÃ³n reloadGalleryFromAdmin ejecutada');
                        } else {
                            log('âš ï¸ FunciÃ³n reloadGalleryFromAdmin no disponible');
                        }
                    } catch (e) {
                        log(`âš ï¸ Error ejecutando reloadGalleryFromAdmin: ${e.message}`);
                    }
                }, 2000);
            } else {
                log('âŒ No se pudo abrir index.html (posible bloqueador de pop-ups)');
                updateStatus('âŒ Error abriendo index.html', 'error');
            }
        }

        function clearLog() {
            document.getElementById('log').textContent = 'Log limpiado...\n';
        }

        // Verificar datos al cargar la pÃ¡gina
        document.addEventListener('DOMContentLoaded', () => {
            log('ğŸ§ª PÃ¡gina de test cargada');
            checkGalleryData();
        });
    </script>
</body>
</html>